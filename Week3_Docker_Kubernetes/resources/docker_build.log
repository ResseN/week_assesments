root@ip-172-31-43-60:/home/admin/python-app# docker build -t python_app:v0.1 .
Sending build context to Docker daemon  86.53kB
Step 1/12 : FROM python:3.6 as base
3.6: Pulling from library/python
bb7d5a84853b: Pull complete 
f02b617c6a8c: Pull complete 
d32e17419b7e: Pull complete 
c9d2d81226a4: Pull complete 
3c24ae8b6604: Pull complete 
e7d6ba99f7d5: Pull complete 
c769d0eaa382: Pull complete 
715c7f9a47c6: Pull complete 
743f3a7e3504: Pull complete 
Digest: sha256:86e63d4e262124f4230174dd54f770beb84f190abc6d2b935c093e3bc9ace6b4
Status: Downloaded newer image for python:3.6
 ---> 1498723101b5
Step 2/12 : FROM base as builder
 ---> 1498723101b5
Step 3/12 : COPY application/  /opt/app/
 ---> 6fdd014e981f
Step 4/12 : WORKDIR /opt/app
 ---> Running in e550d3adcb47
Removing intermediate container e550d3adcb47
 ---> eb027341bd67
Step 5/12 : RUN  grep -oPz "install_requires=\[(.|\n)*?\]" setup.py |      grep -oPz "\'(.*)\',?" | tr ',' '\n' | tr "'" '\n' |      sed 's/\x0//g' | awk 'NF' > requirements.txt &&      pip install -r requirements.txt &&      python3 setup.py install &&      rm -rf .eggs demo.eggs-info build dist setup.py
 ---> Running in ecd2fda62553
Collecting aiohttp
  Downloading aiohttp-3.7.4.post0-cp36-cp36m-manylinux2014_x86_64.whl (1.3 MB)
Collecting multidict==4.5.2
  Downloading multidict-4.5.2-cp36-cp36m-manylinux1_x86_64.whl (309 kB)
Collecting yarl==1.3.0
  Downloading yarl-1.3.0-cp36-cp36m-manylinux1_x86_64.whl (251 kB)
Collecting idna>=2.0
  Downloading idna-3.3-py3-none-any.whl (61 kB)
Collecting async-timeout<4.0,>=3.0
  Downloading async_timeout-3.0.1-py3-none-any.whl (8.2 kB)
Collecting idna-ssl>=1.0
  Downloading idna-ssl-1.1.0.tar.gz (3.4 kB)
Collecting chardet<5.0,>=2.0
  Downloading chardet-4.0.0-py2.py3-none-any.whl (178 kB)
Collecting attrs>=17.3.0
  Downloading attrs-21.2.0-py2.py3-none-any.whl (53 kB)
Collecting typing-extensions>=3.6.5
  Downloading typing_extensions-3.10.0.2-py3-none-any.whl (26 kB)
Building wheels for collected packages: idna-ssl
  Building wheel for idna-ssl (setup.py): started
  Building wheel for idna-ssl (setup.py): finished with status 'done'
  Created wheel for idna-ssl: filename=idna_ssl-1.1.0-py3-none-any.whl size=3178 sha256=b71e2021373b83c8591b4da3b11b74caf60d983247845cf7de968181cc9ff6c6
  Stored in directory: /root/.cache/pip/wheels/6a/f5/9c/f8331a854f7a8739cf0e74c13854e4dd7b1af11b04fe1dde13
Successfully built idna-ssl
Installing collected packages: multidict, idna, yarl, typing-extensions, idna-ssl, chardet, attrs, async-timeout, aiohttp
Successfully installed aiohttp-3.7.4.post0 async-timeout-3.0.1 attrs-21.2.0 chardet-4.0.0 idna-3.3 idna-ssl-1.1.0 multidict-4.5.2 typing-extensions-3.10.0.2 yarl-1.3.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
WARNING: You are using pip version 21.2.4; however, version 21.3.1 is available.
You should consider upgrading via the '/usr/local/bin/python -m pip install --upgrade pip' command.
running install
running bdist_egg
running egg_info
creating demo.egg-info
writing demo.egg-info/PKG-INFO
writing dependency_links to demo.egg-info/dependency_links.txt
writing entry points to demo.egg-info/entry_points.txt
writing requirements to demo.egg-info/requires.txt
writing top-level names to demo.egg-info/top_level.txt
writing manifest file 'demo.egg-info/SOURCES.txt'
reading manifest file 'demo.egg-info/SOURCES.txt'
writing manifest file 'demo.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-x86_64/egg
running install_lib
running build_py
creating build
creating build/lib
creating build/lib/demo
copying demo/__init__.py -> build/lib/demo
copying demo/logger.py -> build/lib/demo
copying demo/__main__.py -> build/lib/demo
copying demo/routes.py -> build/lib/demo
copying demo/views.py -> build/lib/demo
copying demo/web_app.py -> build/lib/demo
copying demo/main.py -> build/lib/demo
creating build/bdist.linux-x86_64
creating build/bdist.linux-x86_64/egg
creating build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/__init__.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/logger.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/__main__.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/routes.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/views.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/web_app.py -> build/bdist.linux-x86_64/egg/demo
copying build/lib/demo/main.py -> build/bdist.linux-x86_64/egg/demo
byte-compiling build/bdist.linux-x86_64/egg/demo/__init__.py to __init__.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/logger.py to logger.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/__main__.py to __main__.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/routes.py to routes.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/views.py to views.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/web_app.py to web_app.cpython-36.pyc
byte-compiling build/bdist.linux-x86_64/egg/demo/main.py to main.cpython-36.pyc
creating build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/PKG-INFO -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/SOURCES.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/dependency_links.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/entry_points.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/not-zip-safe -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/requires.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying demo.egg-info/top_level.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
creating dist
creating 'dist/demo-0.2-py3.6.egg' and adding 'build/bdist.linux-x86_64/egg' to it
removing 'build/bdist.linux-x86_64/egg' (and everything under it)
Processing demo-0.2-py3.6.egg
creating /usr/local/lib/python3.6/site-packages/demo-0.2-py3.6.egg
Extracting demo-0.2-py3.6.egg to /usr/local/lib/python3.6/site-packages
Adding demo 0.2 to easy-install.pth file
Installing demo script to /usr/local/bin

Installed /usr/local/lib/python3.6/site-packages/demo-0.2-py3.6.egg
Processing dependencies for demo==0.2
Searching for yarl==1.3.0
Best match: yarl 1.3.0
Adding yarl 1.3.0 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for multidict==4.5.2
Best match: multidict 4.5.2
Adding multidict 4.5.2 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for aiohttp==3.7.4.post0
Best match: aiohttp 3.7.4.post0
Adding aiohttp 3.7.4.post0 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for idna==3.3
Best match: idna 3.3
Adding idna 3.3 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for idna-ssl==1.1.0
Best match: idna-ssl 1.1.0
Adding idna-ssl 1.1.0 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for chardet==4.0.0
Best match: chardet 4.0.0
Adding chardet 4.0.0 to easy-install.pth file
Installing chardetect script to /usr/local/bin

Using /usr/local/lib/python3.6/site-packages
Searching for async-timeout==3.0.1
Best match: async-timeout 3.0.1
Adding async-timeout 3.0.1 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for attrs==21.2.0
Best match: attrs 21.2.0
Adding attrs 21.2.0 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Searching for typing-extensions==3.10.0.2
Best match: typing-extensions 3.10.0.2
Adding typing-extensions 3.10.0.2 to easy-install.pth file

Using /usr/local/lib/python3.6/site-packages
Finished processing dependencies for demo==0.2
Removing intermediate container ecd2fda62553
 ---> 43f87aeceda8
Step 6/12 : FROM python:3.6-alpine
3.6-alpine: Pulling from library/python
a0d0a0d46f8b: Pull complete 
c11246b421be: Pull complete 
ef6741e6e9c4: Pull complete 
9d6fa827d5ce: Pull complete 
4fbd2be606d8: Pull complete 
Digest: sha256:1fe6d04e64b6df717f5af30dac9e95c922e0744e834ad52517814d74e7558d51
Status: Downloaded newer image for python:3.6-alpine
 ---> 427f9ac9663d
Step 7/12 : RUN adduser --disabled-password pythonuser
 ---> Running in 88fa68094ff4
Removing intermediate container 88fa68094ff4
 ---> 855e67867dbe
Step 8/12 : USER pythonuser
 ---> Running in d496a852180f
Removing intermediate container d496a852180f
 ---> 30553f102e45
Step 9/12 : WORKDIR /opt/app
 ---> Running in 429ae5dc0936
Removing intermediate container 429ae5dc0936
 ---> fafe2dea02dc
Step 10/12 : COPY --from=builder /opt/app/ .
 ---> 2a8573ac0319
Step 11/12 : RUN pip install --no-cache-dir -r requirements.txt
 ---> Running in 7465d3841cad
Defaulting to user installation because normal site-packages is not writeable
Collecting aiohttp
  Downloading aiohttp-3.7.4.post0.tar.gz (1.1 MB)
  Installing build dependencies: started
  Installing build dependencies: finished with status 'done'
  Getting requirements to build wheel: started
  Getting requirements to build wheel: finished with status 'done'
    Preparing wheel metadata: started
    Preparing wheel metadata: finished with status 'done'
Collecting multidict==4.5.2
  Downloading multidict-4.5.2.tar.gz (105 kB)
Collecting yarl==1.3.0
  Downloading yarl-1.3.0.tar.gz (159 kB)
Collecting idna>=2.0
  Downloading idna-3.3-py3-none-any.whl (61 kB)
Collecting typing-extensions>=3.6.5
  Downloading typing_extensions-3.10.0.2-py3-none-any.whl (26 kB)
Collecting attrs>=17.3.0
  Downloading attrs-21.2.0-py2.py3-none-any.whl (53 kB)
Collecting idna-ssl>=1.0
  Downloading idna-ssl-1.1.0.tar.gz (3.4 kB)
Collecting chardet<5.0,>=2.0
  Downloading chardet-4.0.0-py2.py3-none-any.whl (178 kB)
Collecting async-timeout<4.0,>=3.0
  Downloading async_timeout-3.0.1-py3-none-any.whl (8.2 kB)
Building wheels for collected packages: multidict, yarl, aiohttp, idna-ssl
  Building wheel for multidict (setup.py): started
  Building wheel for multidict (setup.py): finished with status 'done'
  Created wheel for multidict: filename=multidict-4.5.2-py3-none-any.whl size=90372 sha256=f354f7de5f8606a05d57282861e3be2ac0269870a55c96c94b806d1813a4cc94
  Stored in directory: /tmp/pip-ephem-wheel-cache-fg0x9733/wheels/61/47/36/c1fc6e4d761f2e498b1bb71bb3a5612488eb4cbcaeac500082
  Building wheel for yarl (setup.py): started
  Building wheel for yarl (setup.py): finished with status 'done'
  Created wheel for yarl: filename=yarl-1.3.0-py3-none-any.whl size=84928 sha256=89019c18f195ae52b8a106c083ebf78c8423c63987781818cda75e29aa70a781
  Stored in directory: /tmp/pip-ephem-wheel-cache-fg0x9733/wheels/2f/6f/d7/79e82f6c722c8b0fee1d18d12f8e13681984630b58d9b3e40a
  Building wheel for aiohttp (PEP 517): started
  Building wheel for aiohttp (PEP 517): finished with status 'done'
  Created wheel for aiohttp: filename=aiohttp-3.7.4.post0-py3-none-any.whl size=451944 sha256=91c1bb7e429217824ca23b59cde8e89f2b09420fad30674f0ed79758f1100088
  Stored in directory: /tmp/pip-ephem-wheel-cache-fg0x9733/wheels/09/e1/c2/0a81deae59a32de7e6d712020151d052d44151c4fd4cc5e572
  Building wheel for idna-ssl (setup.py): started
  Building wheel for idna-ssl (setup.py): finished with status 'done'
  Created wheel for idna-ssl: filename=idna_ssl-1.1.0-py3-none-any.whl size=3178 sha256=280abd1d0a6d22155aa6aa0976c577bfde832a82cfedb7e998b184703abd3a7f
  Stored in directory: /tmp/pip-ephem-wheel-cache-fg0x9733/wheels/6a/f5/9c/f8331a854f7a8739cf0e74c13854e4dd7b1af11b04fe1dde13
Successfully built multidict yarl aiohttp idna-ssl
Installing collected packages: multidict, idna, yarl, typing-extensions, idna-ssl, chardet, attrs, async-timeout, aiohttp
  WARNING: The script chardetect is installed in '/home/pythonuser/.local/bin' which is not on PATH.
  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.
Successfully installed aiohttp-3.7.4.post0 async-timeout-3.0.1 attrs-21.2.0 chardet-4.0.0 idna-3.3 idna-ssl-1.1.0 multidict-4.5.2 typing-extensions-3.10.0.2 yarl-1.3.0
WARNING: You are using pip version 21.2.4; however, version 21.3.1 is available.
You should consider upgrading via the '/usr/local/bin/python -m pip install --upgrade pip' command.
Removing intermediate container 7465d3841cad
 ---> 0a5024df5553
Step 12/12 : CMD ["python3", "-m", "demo"]
 ---> Running in 80e6482d8022
Removing intermediate container 80e6482d8022
 ---> 54699dd92e29
Successfully built 54699dd92e29
Successfully tagged python_app:v0.1
